{"posts":[{"title":"PTE靶场学习","content":"CISP-PTE考试的实操题型一般包括基础题: 5个key:centos+apache+php+mysql+cms http://172.16.12.16.100:81-85 ;综合题：3个key:win2008+wamp()+dedecmsv5.6utf-8 . 另外还有20道选择题,一题一分. https://picgo-zhang.oss-cn-shanghai.aliyuncs.com/picgo/main/ 基础题 SQL注入 根据题目需要利用load_file()函数读取key文件; 基础题目之SQL注入 点击答题,sql语句直接显示在页面,注入点在id参数,尝试进行联合查询注入,后端过滤了空格使用/**/注释符绕过,后端过滤了union,大小写绕过无法成功,使用双写成功绕过;还尝试闭合时还发现过滤了#,使用%23替代,页面显示位为2、3、4,在任意位上使用load_file('/tmp/360/key')即可读取key1,payload如下 -1')/**/ununionion/**/select/**/1,2,3,load_file('/tmp/360/key')%23 key1 本题主要考察联合查询注入以及mysql读写文件,是PTE经典的考核内容,在其基础上也会增加难度，变化形式考核万能密码、二阶注入、insert注入等知识点.考试时允许使用sqlmap自动化注入,不过需要注意使用tamper绕过WAF。 文件上传 第二题一般是文件上传突破，可以上传图片马进行突破，后端没有使用白名单限制文件上传类型，可以上传同样可以被当作php文件执行的php3、php5、php7、phtml后缀类型的文件；但waf过滤了eval()函数的执行，可以使用system()执行系统命令绕过， 文件头需要添加GIF89a 绕过文件内容检测 key2-system函数 还可以使用php读取文件的函数,直接读取到key,例如readfile()、highlight_file()、echo file_get_contents(); 文件包含 本题主要考察php伪协议的使用,可以使用php://filter/convert.base64-encode/resource直接读取key.php,base64解码后得到key;也可以使用php://input 执行system()函数;也可以使用data://text/plan,<?php highlight_file('../key.php');?> 读取key;也可以远程包含文件上传的一句话木马. key3 这道题变化的话会过滤伪协议,使用大小写或双写绕过即可; 命令执行 本题主要考察linux命令相关知识,利用命令连接符 | || &amp;&amp; ; 等,需要尽可能多的记住可以读取文件内容的命令,例如 cat、less、more、head、tail、vi、xxd、tac等等；也可以选择使用绕过，记住常见的关键字绕过方式。 key4 如果其他命令可以执行但无法读取文件，可能是未设置读取文件的权限，需要手动赋予权限。 5.日志分析 key5 第5题日志分析,攻击IP分别为172.16.12.1和172.16.12.12,题干中说攻击者IP为172.16.12.12忽略前半部分日志,关注攻击者从2017/10/31 15:32:55开始的目录扫描,持续到15:45:20爆破成功,发现后台路径 /adminlogin.php,然后尝试爆破得到账密admin:password123,成功登录得到key:9y6u8s5m. 综合题 综合题考的是windows机器,win2008+phpstudy+dedecmsv5.6-utf8. 使用御剑进行目录扫描发现cms后台路径/dede和数据库管理后台路径/phpmyadmin. 尝试默认密码root:root登录数据库管理后台,发现站点数据库dedecmsv56utf,在dede_admin表中找到管理员账号及hash,hash长度为20,md5解码得到密码为888888,也可以使用hackbar将自定义密码md5加密后去除前5后7位后替换密码hash后执行. phpmyadmin 在数据库中查询@@datadir,发现数据库命令为C:\\phpStudy\\MySQL\\data,猜测使用phpstudy部署站点,猜测站点web目录为c:\\phpStudy\\www. 在数据库中尝试执行into outfile语句写入一句话木马,报错无权限. 报错结果 在phpmyadmin主页尝试修改变量\"general log\"为ON,\"general log file\"为web目录,在sql页面查询`select \"<?php eval($_POST['a']);?>\"` 将木马写入日志文件,使用蚁剑连接,连接成功. 开启日志 在web目录下得到key2. 考虑实际情况需要关闭防火墙,根据windows版本 win2003: netsh firewall set opmode disable win2008: netsh advfirewall set allprofiles state off 选择不同命令关闭防火墙;如果3389端口未开启需要上传3389.bat开启远程桌面端口.在Administrator用户桌面可以找到key3. ","link":"https://zhangwenbo1229.github.io/zhangwenbo1229/post/pte-ba-chang-xue-xi/"}]}